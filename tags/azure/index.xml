<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Azure on Coding notes - cheat sheets and snippets</title>
    <link>https://www.bustroker.com/tags/azure/</link>
    <description>Recent content in Azure on Coding notes - cheat sheets and snippets</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 22 Sep 2020 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://www.bustroker.com/tags/azure/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Authenticate and call Azure App Service with AAD using curl</title>
      <link>https://www.bustroker.com/notes/authenticate-and-call-azure-app-service-with-aad-using-curl/</link>
      <pubDate>Tue, 22 Sep 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/authenticate-and-call-azure-app-service-with-aad-using-curl/</guid>
      <description>Get AAD access token curl -X POST -d &amp;#39;grant_type=client_credentials&amp;amp;client_id=&amp;lt;APP_ID&amp;gt;&amp;amp;client_secret=&amp;lt;PASSWORD&amp;gt;&amp;amp;resource=https%3A%2F%2Fmanagement.azure.com%2F&amp;#39; https://login.microsoftonline.com/&amp;lt;TENANT_ID&amp;gt;/oauth2/token Use bearer token in requests curl -H &amp;#39;Accept: application/json&amp;#39; -H &amp;#34;Authorization: Bearer &amp;lt;TOKEN&amp;gt;&amp;#34; https://bustroker.com/api/resource Common curl patterns POST form data curl -X POST http://localhost:8080/data -d &amp;#34;param1=value1&amp;amp;param2=value2&amp;#34; POST JSON curl -X POST http://localhost:3000/data -H &amp;#34;Content-Type: application/json&amp;#34; -d &amp;#39;{&amp;#34;key1&amp;#34;:&amp;#34;value1&amp;#34;, &amp;#34;key2&amp;#34;:&amp;#34;value2&amp;#34;}&amp;#39; POST from file curl -X POST http://localhost:3000/data -d &amp;#34;@data.txt&amp;#34; Disable certificate validation curl -k https://localhost:8080 Format and parse responses Add newline after output curl localhost:8080 ;echo Pretty print JSON curl localhost:8080 | json_pp curl localhost:8080 | jq &amp;#34;.</description>
    </item>
    <item>
      <title>Configure URL Rewrites in web.config for IIS</title>
      <link>https://www.bustroker.com/notes/configure-url-rewrites-in-web.config-for-iis/</link>
      <pubDate>Tue, 09 Jun 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/configure-url-rewrites-in-web.config-for-iis/</guid>
      <description>Goal Map internal application URLs to different public-facing URLs without redirects (no 3xx responses, no browser URL changes).&#xA;The Difference Rewrite ≠ Redirect. A rewrite maps URLs at the IIS level before they reach your application.&#xA;IIS URL Rewrite Module Documentation&#xA;Basic Example Expose /internalendpoint as /publicendpoint:&#xA;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt; &amp;lt;configuration&amp;gt; &amp;lt;system.webServer&amp;gt; &amp;lt;rewrite&amp;gt; &amp;lt;rules&amp;gt; &amp;lt;rule name=&amp;#34;basic&amp;#34; stopProcessing=&amp;#34;true&amp;#34;&amp;gt; &amp;lt;match url=&amp;#34;^publicendpoint$&amp;#34; /&amp;gt; &amp;lt;action type=&amp;#34;Rewrite&amp;#34; url=&amp;#34;/internalendpoint&amp;#34; /&amp;gt; &amp;lt;/rule&amp;gt; &amp;lt;/rules&amp;gt; &amp;lt;/rewrite&amp;gt; &amp;lt;/system.webServer&amp;gt; &amp;lt;/configuration&amp;gt; The match URL uses regex.</description>
    </item>
    <item>
      <title>ILogger&lt;TCategory&gt; with Azure App Service Application Insights &#43; Live Metrics</title>
      <link>https://www.bustroker.com/notes/iloggertcategory-with-azure-app-service-application-insights--live-metrics/</link>
      <pubDate>Fri, 05 Jun 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/iloggertcategory-with-azure-app-service-application-insights--live-metrics/</guid>
      <description>Goal Send ILogger&amp;lt;TCategory&amp;gt; logs to Azure Application Insights and enable Live Metrics.&#xA;Setup Application Insights Install the package:&#xA;dotnet add package Microsoft.ApplicationInsights.AspnetCore Register the service:&#xA;// Startup.cs public void ConfigureServices(IServiceCollection services) { services.AddApplicationInsightsTelemetry(); ... } Configure the instrumentation key:&#xA;// appsettings.json { &amp;#34;ApplicationInsights&amp;#34;: { &amp;#34;InstrumentationKey&amp;#34;: &amp;#34;putinstrumentationkeyhere&amp;#34; }, ... } Alternatively, pass the key directly to AddApplicationInsightsTelemetry().&#xA;Configure ILogger to Send to Application Insights // Program.cs public static IHostBuilder CreateHostBuilder(string[] args) =&amp;gt; Host.</description>
    </item>
    <item>
      <title>Get Azure Managed Identity tokens with cURL</title>
      <link>https://www.bustroker.com/notes/get-azure-managed-identity-tokens-with-curl/</link>
      <pubDate>Sun, 31 May 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/get-azure-managed-identity-tokens-with-curl/</guid>
      <description>Goal: Retrieve an access token using Azure Managed Identity from within a VM.&#xA;Get a token SSH (or RDP) into a VM with Managed Identity enabled and request a token:&#xA;curl &amp;#34;http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;amp;resource=https%3A%2F%2Fmanagement.azure.com%2F&amp;#34; -H Metadata:true -s The resource parameter specifies the App ID URI of the target resource. It becomes the aud (audience) claim in the token.&#xA;Target different resources For Azure Storage:&#xA;curl &amp;#39;http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;amp;resource=https%3A%2F%2Fstorage.azure.com%2F&amp;#39; -H Metadata:true Official documentation</description>
    </item>
    <item>
      <title>Enable Azure App Service Health Check from Azure CLI</title>
      <link>https://www.bustroker.com/notes/enable-azure-app-service-health-check-from-azure-cli/</link>
      <pubDate>Mon, 18 May 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/enable-azure-app-service-health-check-from-azure-cli/</guid>
      <description>Enable the health check feature via Azure CLI instead of manually through Azure Resource Explorer.&#xA;How Health Check Works Platform sends requests every ~1 minute to the configured endpoint Requests rotate round-robin across all VM instances behind the load balancer If Easy Auth is enabled, authentication is disabled for the health check endpoint only Enable Health Check Set the health check endpoint using az resource update:&#xA;az login # if not already authenticated az resource update \ --ids /subscriptions/&amp;lt;SUBSCRIPTION_ID&amp;gt;/resourceGroups/&amp;lt;RESOURCE_GROUP_NAME&amp;gt;/providers/Microsoft.</description>
    </item>
    <item>
      <title>Azure App Configuration. On-Demand Refresh</title>
      <link>https://www.bustroker.com/notes/azure-app-configuration.-on-demand-refresh/</link>
      <pubDate>Wed, 06 May 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/azure-app-configuration.-on-demand-refresh/</guid>
      <description>The Problem Azure App Configuration&amp;rsquo;s default middleware triggers refresh checks on every HTTP request. With a 30-second cache:&#xA;Short cache = High costs: One request every 30 seconds = 200K+ calls/day across 10 services (beyond free tier) Long cache = Slow updates: Configuration changes take longer to propagate Goal Minimal API calls to App Configuration Fast configuration updates when needed Manual control over refresh timing Implementation OnDemandAzureAppConfigurationRefresher public class OnDemandAzureAppConfigurationRefresher : IAzureAppConfigurationRefresher { private readonly List&amp;lt;IConfigurationRefresher&amp;gt; _configurationRefreshers = new List&amp;lt;IConfigurationRefresher&amp;gt;(); public OnDemandAzureAppConfigurationRefresher(IConfiguration configuration) { var configurationRoot = configuration as IConfigurationRoot; if (configurationRoot == null) { throw new InvalidOperationException(&amp;#34;The &amp;#39;IConfiguration&amp;#39; injected in OnDemantConfigurationRefresher is not an &amp;#39;IConfigurationRoot&amp;#39;, and needs to be as well.</description>
    </item>
    <item>
      <title>Debugging Azure App Service 500.30 startup failures with Application Insights</title>
      <link>https://www.bustroker.com/notes/debugging-azure-app-service-500.30-startup-failures-with-application-insights/</link>
      <pubDate>Wed, 06 May 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/debugging-azure-app-service-500.30-startup-failures-with-application-insights/</guid>
      <description>Goal Capture and diagnose silent startup failures in Azure App Service that only show HTTP Error 500.30 - ANCM In-Process Start Failure.&#xA;The Problem Azure App Service fails with a generic IIS error page that provides no actionable information:&#xA;&amp;lt;body&amp;gt; &amp;lt;h1&amp;gt; HTTP Error 500.30 - ANCM In-Process Start Failure &amp;lt;/h1&amp;gt; &amp;lt;h2&amp;gt; Common solutions to this issue: &amp;lt;/h2&amp;gt;&amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;The application failed to start&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;The application started but then stopped&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;The application started but threw an exception during startup&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt; &amp;lt;h2&amp;gt; Troubleshooting steps: &amp;lt;/h2&amp;gt; &amp;lt;ul&amp;gt; &amp;lt;li&amp;gt; Check the system event log for error messages &amp;lt;/li&amp;gt; &amp;lt;li&amp;gt; Enable logging the application process&amp;#39; stdout messages &amp;lt;/li&amp;gt; &amp;lt;li&amp;gt; Attach a debugger to the application process and inspect &amp;lt;/li&amp;gt; &amp;lt;/ul&amp;gt; &amp;lt;h2&amp;gt; For more information visit: &amp;lt;a href=&amp;#34;https://go.</description>
    </item>
    <item>
      <title>Azure App Configuration with Key Vault and Managed Identity in HA</title>
      <link>https://www.bustroker.com/notes/azure-app-configuration-with-key-vault-and-managed-identity-in-ha/</link>
      <pubDate>Thu, 30 Apr 2020 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/azure-app-configuration-with-key-vault-and-managed-identity-in-ha/</guid>
      <description>Goal: Production-ready Azure App Configuration setup with Key Vault secrets, Managed Identity authentication, and High Availability.&#xA;How the Client Works Azure App Configuration client uses the sentinel pattern - a single key that determines if a full configuration refresh is needed.&#xA;On Refresh():&#xA;If cache is valid → does nothing If cache expired → fetches sentinel key If sentinel unchanged → does nothing If sentinel changed → refreshes all configuration On failure → attempts failover App Configuration (typically different region) Important: Update the sentinel whenever you change any parameter to trigger a client refresh.</description>
    </item>
    <item>
      <title>Kusto Query Cheatsheet for Application Insights</title>
      <link>https://www.bustroker.com/notes/kusto-query-cheatsheet-for-application-insights/</link>
      <pubDate>Fri, 25 Oct 2019 00:00:00 +0000</pubDate>
      <guid>https://www.bustroker.com/notes/kusto-query-cheatsheet-for-application-insights/</guid>
      <description>Request Duration Distribution (100ms bins) app(&amp;#34;bustroker-sales-webapi&amp;#34;).requests | where name == &amp;#34;POST SalesController/Post&amp;#34; | project req_timestamp = timestamp, req_id = id, req_name = name, req_url = url, req_success = success, req_resultCode = resultCode, req_duration = duration, req_operation_name = operation_Name, req_operation_Id = operation_Id | summarize count() by bin(req_duration, 100) | sort by req_duration asc | render timechart Request and Dependency Duration Percentiles Calculate percentiles (p25, p50, p95, p99) for core requests and their dependencies:</description>
    </item>
  </channel>
</rss>
